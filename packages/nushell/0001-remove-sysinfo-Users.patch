From 737061c8c3b6ba2d0cf81e280659ea8a1a6c34a3 Mon Sep 17 00:00:00 2001
From: Termux <contact@termux.dev>
Date: Fri, 14 Nov 2025 12:06:03 +0600
Subject: [PATCH 1/2] remove `sysinfo::Users`

Starting from version 0.36, the `user` feature of `sysinfo` crate uses `getpwent`, etc.
These were added to Android in API 26, but termux currently targets API 24.
---
 crates/nu-command/src/system/sys/users.rs | 34 +----------------------
 1 file changed, 1 insertion(+), 33 deletions(-)

diff --git a/crates/nu-command/src/system/sys/users.rs b/crates/nu-command/src/system/sys/users.rs
index 55cedb5..e96d7d7 100644
--- a/crates/nu-command/src/system/sys/users.rs
+++ b/crates/nu-command/src/system/sys/users.rs
@@ -1,6 +1,4 @@
-use super::trim_cstyle_null;
 use nu_engine::command_prelude::*;
-use sysinfo::Users;
 
 #[derive(Clone)]
 pub struct SysUsers;
@@ -40,35 +38,5 @@ impl Command for SysUsers {
 }
 
 fn users(span: Span) -> Value {
-    let users = Users::new_with_refreshed_list()
-        .iter()
-        .map(|user| {
-            let groups = user
-                .groups()
-                .iter()
-                .map(|group| Value::string(trim_cstyle_null(group.name()), span))
-                .collect();
-
-            // On Windows, Uid wraps a SID (Security Identifier) which is a string like "S-1-5-18"
-            // On Unix-like systems (macOS, Linux, BSD), Uid wraps a numeric u32 user ID
-            // We need conditional compilation to handle these platform differences
-            #[cfg(windows)]
-            let id_value = Value::string(user.id().to_string(), span);
-            #[cfg(not(windows))]
-            let id_value = {
-                let id_ref: &u32 = user.id();
-                Value::int((*id_ref) as i64, span)
-            };
-
-            let record = record! {
-                "id" => id_value,
-                "name" => Value::string(trim_cstyle_null(user.name()), span),
-                "groups" => Value::list(groups, span),
-            };
-
-            Value::record(record, span)
-        })
-        .collect();
-
-    Value::list(users, span)
+    Value::list(Vec::new(), span)
 }
-- 
2.53.0

